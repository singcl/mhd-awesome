# JS位运算符妙用
> 1. 位运算直接对二进制位进行计算，位运算直接处理每一个比特位，是非常底层的运算，好处是速度极快，缺点是很不直观，许多场合不能够使用。
> 2. 位运算只对整数起作用，如果一个运算子不是整数，会自动转为整数后再运行。
> 3. 在JavaScript 内部，数值都是以64位浮点数的形式储存，但是做位运算的时候，是以32位带符号的整数进行运算的，并且返回值也是一个32位带符号的整数。
> 参考：https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/Bitwise_Operators
> 参考：http://javascript.ruanyifeng.com/grammar/operator.html

## 浮点数的真模样
> - 所有 JavaScript 数字均为 64 位。JavaScript 不是类型语言。与许多其他编程语言不同，JavaScript 不定义不同类型的数字，比如整数、短、长、浮点等等。
> - 精度。整数（不使用小数点或指数计数法）最多为 15 位。小数的最大位数是 17，但是浮点运算并不总是 100% 准确.
> - 参考：http://www.w3school.com.cn/js/js_obj_number.asp
------
```
JavaScript 中的所有数字都存储为根为 10 的 64 位（8 比特），浮点数。
浮点数的真模样我们知道，像上文中的那个二进制小数1110.1101事实上也是按照人类习惯表达出来的，但是计算机可是不能识别这种带小数点的东西的哦。所以计
算机会使用之前介绍的数字格式来表示这样一个数字，那么一个二进制浮点数在计算机中到底是如何表现的呢？其实在上文介绍数字格式的部分已经介绍过了，但是
没有实际看一眼终究是不能有一个直观的认识，那在本文的最后，我们就来看一个二进制浮点数的在计算机中真实的样子。0100000001000111101101101101001001001000010101110011000100100011这是一个64位的二进制数。如果把它作为一个双精度浮点数，那么它的各部分都分别表示了什么呢？按照上文介绍浮点数的部分，我们可以将它分成如下几部分：符号：0指数部分：10000000100（二进制，可以转换为十进制的1028）尾数部分：0111101101101101001001001000010101110011000100100011因此，将它转换为一个用二进制表示的小数，则是：(-1)^0 * 1.0111101101101101001001001000010101110011000100100011  x 2^(1028-1023)= 1.0111101101101101001001001000010101110011000100100011  x 2^5= 101111.01101101101001001001000010101110011000100100011如果各位读者观察足够仔细的话，是否发现了有趣的一点呢？那就是在这个在计算机中用来表示双精度浮点数的64位数中，尾数部分的几位数字是：0111101101101101001001001000010101110011000100100011但是经过从计算机中的形式转化成人类使用二进制表示小数的形式之后，数字却变成了1.0111101101101101001001001000010101110011000100100011x 2^5，小数点之前为什么会多出了一个1呢？这是因为在尾数部分，为了将表现形式多样的浮点数统一为同一种表示方式而规定要将小数点前的值固定为1。由于小数点前的数永远是1，因此为了节省一个数据位，这个1在计算机中并不需要被保存。那么应该如何保证一个二进制小数的小数点前的值是1呢？这就需要对二进制小数进行逻辑移位了，通过左移或右移若干次后，将整数部分变为1。例如上文中的这个二进制小数：1110.1101，我们就来试试如何把它变成计算机可以识别的浮点数的尾数吧。1110.1101（原始数据）——>0001.1101101（通过右移将整数部分变为1）——>0001.11011010000000000000....（拓展位数，使之符合数字格式的规定）——>11011010000000000000....（去掉整数部分，仅保留小数部分）
```
> 参考：https://www.zhihu.com/question/26806477/answer/125001707

JS中位运算符大概7个,下面一一介绍

## 按位与(AND) `&`
`&`是二元运算符，它以特定的方式组合操作二进制数中对应的位，如果对应的位都为1，那么结果就是1， 如果任意一个位是0 则结果就是0。
```js
// 1的二进制表示为: 00000000 00000000 00000000 00000001
// 3的二进制表示为: 00000000 00000000 00000000 00000011
// -----------------------------
// 1的二进制表示为: 00000000 00000000 00000000 00000001
console.log(1 & 3)     // 1
```
## 按位或(OR) `|`

`|` 运算符跟 `&` 的区别在于如果对应的位中任一个操作数为1 那么结果就是1。
```js
// 1的二进制表示为: 00000000 00000000 00000000 00000001
// 3的二进制表示为: 00000000 00000000 00000000 00000011
// -----------------------------
// 3的二进制表示为: 00000000 00000000 00000000 00000011
console.log(1 | 3)     // 3
```
## 按位异或(XOR) `^`
`^` 运算符跟 `|` 类似，但有一点不同的是 如果两个操作位都为1的话，结果产生0。
```js
// 1的二进制表示为: 00000000 00000000 00000000 00000001
// 3的二进制表示为: 00000000 00000000 00000000 00000011
// -----------------------------
// 2的二进制表示为: 00000000 00000000 00000000 00000010
console.log(1 ^ 3)     // 2
```
## 按位非(NOT) `~`
`~` 运算符是对位求反，1变0,0变1，也就是求二进制的反码.
```js
// 1的二进制表示为: 00000000 00000000 00000000 00000001
// 3的二进制表示为: 00000000 00000000 00000000 00000011
// -----------------------------
// 1反码二进制表示: 11111111 11111111 11111111 11111110
// 由于第一位（符号位）是1，所以这个数是一个负数。JavaScript 内部采用补码形式表示负数，即需要将这个数减去1，再取一次反，然后加上负号，才能得到这个负数对应的10进制值。
// -----------------------------
// 1的反码减1：     11111111 11111111 11111111 11111101
// 反码取反：       00000000 00000000 00000000 00000010
// 表示为10进制加负号：-2
console.log(~ 1)     // -2
```
- **简单记忆：一个数与自身的取反值相加等于-1**。
## 左移（Left shift）`<<`

`<<`运算符使指定值的二进制所有位都左移规定的次数，对于其移动规则只需记住**`丢弃最高位，0补最低位`**即按二进制形式把所有的数字向左移动对应的位数，高位移出(舍弃)，低位的空位补零。
```js
// 1的二进制表示为: 00000000 00000000 00000000 00000001
// -----------------------------
// 2的二进制表示为: 00000000 00000000 00000000 00000010
console.log(1 << 1)     // 2
```
## 有符号右移`>>`
`>>`运算符使指定值的二进制所有位都右移指定的次数，对于其移动规则只需记住**`符号位不变，左边补上符号位`**即按二进制形式把所有的数字向右移动对应的位数，低位移出(舍弃)，高位的空位补符号位，即正数补零，负数补1。
```js
// 1的二进制表示为: 00000000 00000000 00000000 00000001
// -----------------------------
// 0的二进制表示为: 00000000 00000000 00000000 00000000
console.log(1 >> 1)     // 0
```
## 无符号右移`>>>`
`>>>`运算符忽略了符号位扩展，0补最高位，但是只是对32位和64位的值有意义。

## 位运算符在js中的妙用
1. 使用&运算符判断一个数的奇偶
```js
// 偶数 & 1 = 0
// 奇数 & 1 = 1
console.log(0 & 1)    // 0
console.log(3 & 1)    // 1
```
2. 使用`~, >>, <<, >>>, |`来取整
```js
console.log(~~ 3.14)    // 3
console.log(3.14 >> 0)  // 3
console.log(3.14 << 0)  // 3
console.log(3.14 | 0)   // 3
// >>>不可对负数取整
console.log(3.14 >>> 0)   // 3
```
3. 使用`^`来完成值交换
```js
var a = 1
var b = 2
a ^= b
b ^= a
a ^= b
console.log(a)   // 2
console.log(b)   // 1
```
4. 使用`&, >>, |`来完成rgb值和16进制颜色值之间的转换
```js
// 16进制颜色值转RGB：
function hexToRGB(hex){
    var hex = hex.replace("#","0x"),
        r = hex >> 16,
        g = hex >> 8 & 0xff,
        b = hex & 0xff;
    return "rgb("+r+","+g+","+b+")";
}

// RGB转16进制颜色值：
function RGBToHex(rgb){
    var rgbArr = rgb.split(/[^\d]+/),
        color = rgbArr[1]<<16 | rgbArr[2]<<8 | rgbArr[3];
    return "#"+color.toString(16);
}
// -------------------------------------------------
hexToRGB("#ffffff")               // "rgb(255,255,255)"
RGBToHex("rgb(255,255,255)")      // "#ffffff"
```
